<h1 id="create-a-new-origami-component---part-6-testing">Create A New Origami Component - Part 6 Testing</h1>

<p>The “Create A New Origami Component” tutorial is split into eight parts and is intended to be followed sequentially from start to finish:</p>
<ol>
  <li><a href="/documentation/tutorials/create-a-new-component-part-1/">Intro &amp; Boilerplate</a></li>
  <li><a href="/documentation/tutorials/create-a-new-component-part-2/">Base Styles</a></li>
  <li><a href="/documentation/tutorials/create-a-new-component-part-3/">Themes &amp; Brands</a></li>
  <li><a href="/documentation/tutorials/create-a-new-component-part-4/">Demos</a></li>
  <li><a href="/documentation/tutorials/create-a-new-component-part-5/">JavaScript</a></li>
  <li>Testing</li>
  <li><a href="/documentation/tutorials/create-a-new-component-part-7/">Documentation</a></li>
  <li><a href="/documentation/tutorials/create-a-new-component-part-8/">Component Lifecycle</a></li>
</ol>

<p>In part six we will add tests to our component. Including tests for Sass, JavaScript, and common accessibility issues.</p>

<p>Run <code class="language-plaintext highlighter-rouge">obt test</code> to run component tests. Run <code class="language-plaintext highlighter-rouge">obt verify</code> to lint code style and check the validity of <code class="language-plaintext highlighter-rouge">origami.json</code>.</p>

<h2 id="javascript-tests">JavaScript Tests</h2>

<p>Component JavaScript tests use <a href="https://mochajs.org/">mocha</a> as a test runner; <a href="https://sinonjs.org/">sinon</a> for stubs, spies, and mocks; and <a href="https://github.com/rowanmanning/proclaim">proclaim</a> to make assertions.</p>

<p>To demonstrate how these projects are used to test components we will add a new test to confirm that clicking a button in our component increments the count.</p>

<p>JavaScript tests are located under the <code class="language-plaintext highlighter-rouge">tests/js</code> directory. The file <code class="language-plaintext highlighter-rouge">example.test.js</code> already has boilerplate tests, which use component markup defined in <code class="language-plaintext highlighter-rouge">tests/js/helpers/fixtures.js</code> to confirm the <code class="language-plaintext highlighter-rouge">init</code> method works as expected.</p>

<p>Our first step will be to update the <code class="language-plaintext highlighter-rouge">htmlCode</code> method in <code class="language-plaintext highlighter-rouge">tests/js/helpers/fixtures.js</code> with our latest component markup. We’ll add an id <code class="language-plaintext highlighter-rouge">id="element"</code> which we can use in our tests:</p>
<pre><code class="o-syntax-highlight--js">// tests/js/helpers/fixtures.js

function htmlCode () {
	const html = `
        &lt;div id="element" class="o-example" data-o-component="o-example"&gt;
            Hello world, I am a component named o-example!
            &lt;span class="o-example__counter"&gt;
                You have clicked this lovely button &lt;span data-o-example-current-count&gt;0&lt;/span&gt; times.
                &lt;button class="o-example__button"&gt;count&lt;/button&gt;
            &lt;span&gt;
        &lt;/div&gt;
	`;
	insert(html);
}
</code></pre>

<p>Next we can append our new tests within the main <code class="language-plaintext highlighter-rouge">describe("Example", () =&gt; {})</code> block:</p>
<pre><code class="o-syntax-highlight--js">// tests/js/example.test.js

describe("with a button", () =&gt; {

    beforeEach(() =&gt; {
        // Add our component markup to the DOM
        fixtures.htmlCode();
    });

    afterEach(() =&gt; {
        // Remove our component markup from the DOM
        fixtures.reset();
    });

    it("should increment the count on click", () =&gt; {
        // initialise o-example on fixture markup
        const oExample = Example.init('#element');
        // find and click the button
        const button = document.querySelector('button');
        button.click();
        // confirm the count has incremented
        const actual = oExample.count;
        const expected = 1;
        proclaim.equal(actual, expected, `Expected count to equal ${expected} given a single button click.`);
    });

    it("should display the new count on click", () =&gt; {
        // initialise o-example on fixture markup
        Example.init('#element');
        // find and click the button
        const button = document.querySelector('button');
        button.click();
        // confirm the new count is reflected in the DOM
        const countElement = document.querySelector('[data-o-example-current-count]');
        const actual = countElement.textContent;
        const expected = '1';
        proclaim.include(
            actual,
            expected,
            `Expected the new count to display in the component.`
        );
    });
});
</code></pre>

<p>Now run <code class="language-plaintext highlighter-rouge">obt test</code>. You should see our new tests are run and pass.</p>

<p>The debug flag <code class="language-plaintext highlighter-rouge">obt test --debug</code> is useful whilst actively working on or debugging JavaScript tests. It allows you to run tests in the browser and get feedback in the browsers developer console. The <code class="language-plaintext highlighter-rouge">--browserstack</code> flag also enables tests to run against multiple browsers at once in <a href="browserstack.com/">BrowserStack</a>. See the <a href="https://github.com/Financial-Times/origami-build-tools">Origami Build Tools documentation</a> for more details.</p>

<h2 id="sass-tests">Sass Tests</h2>

<p>Component Sass tests are run using the <a href="https://www.oddbird.net/true/">Oddbird True</a> library. Sass tests for a component are located in the <code class="language-plaintext highlighter-rouge">tests/scss</code> directory.</p>

<p>This tutorial won’t cover Oddbird True in detail, for that see the <a href="https://www.oddbird.net/true/docs/">Oddbird True documentation</a>. However to demonstrate we will update the boilerplate test (<code class="language-plaintext highlighter-rouge">tests/scss/_main.test.scss</code>) to confirm the <code class="language-plaintext highlighter-rouge">oExample</code> mixin outputs CSS for the inverse theme by default:</p>

<pre><code class="o-syntax-highlight--scss">// tests/scss/_main.test.scss

@include describe('oExample mixins') {
    // tests for the primary mixin oExample
	@include describe('oExample') {
		@include it('outputs the inverse theme by default') {
			@include assert() {
				// output actual CSS
				@include output() {
					@include oExample();
				}
				// expected output CSS to contain
				@include contains() {
					.o-example--inverse {
						background: #262a33;
						color: #ffffff;
					}
				}
			}
		}
	}
}</code></pre>

<p>Again running the <code class="language-plaintext highlighter-rouge">obt test</code> command should show our new tests have run and passed.</p>

<h2 id="accessibility-tests">Accessibility Tests</h2>

<p><code class="language-plaintext highlighter-rouge">obt test</code> also runs some accessibility checks against the <code class="language-plaintext highlighter-rouge">pa11y</code> demo, as we <a href="/documentation/tutorials/create-a-new-component-part-4#pa11y-demo">discussed in part four</a>. Whilst this will catch some common causes of accessibility issues, such as invalid html or low contrast between text and background, it is not a comprehensive test of component accessibility. For help testing the accessibility of your component see the <a href="/documentation/principles/accessibility/">Origami’s accessibility principles</a> page, or reach out to the Financial Times <a href="https://app.slack.com/client/T025C95MN/C2LMEKC6S">#accessibility Slack channel</a>.</p>

<h2 id="visual-regression-tests">Visual Regression Tests</h2>

<p>To check all component demos for any visual bugs that may have been introduced accidentally as part of a change may be rather taxing as a manual piece of work. To help, demos may be run through <a href="https://percy.io/">percy.io</a> to highlight visual differences between two versions of a component automatically.</p>

<p>We can’t run Percy yet as we haven’t released a version of our component to compare changes against. But later, when we have released our component, you will be able to run <a href="https://percy.io/">percy.io</a> by adding a <code class="language-plaintext highlighter-rouge">percy</code> label to Github pull requests. When Percy has run a comment is added to the pull request, and the demo comparisons are ready for review at <a href="https://percy.io/Financial-Times/">percy.io/Financial-Times</a>.</p>

<figure>
	<img alt="" src="/assets/images/tutorial-new-component/hello-world-demo-21-tests.png" />
	<figcaption>
        This image show a Github pull request where the `percy` label had been added. Percy then ran to visually compare the component demos in the pull request against the last release, and removed the `percy` label when done.
	</figcaption>
</figure>

<figure>
	<img alt="" src="/assets/images/tutorial-new-component/hello-world-demo-22-tests.png" />
	<figcaption>
        This image shows an example of the Percy interface. To the left is an image of a component demo, to the right the updated demo with visual changes highlighted in red.
	</figcaption>
</figure>

<p><em>Don’t worry if you are unfamiliar with Github and pull request labels. Later, when releasing our component, we will discuss other available labels and link to helpful Github documentation. For now its useful to know that visual regression tests can be run, even if you’re not sure yet how they work.</em></p>

<h2 id="part-seven-documentation">Part Seven: Documentation</h2>

<p>Our component is working well and is almost complete. In this tutorial we learned:</p>
<ul>
  <li>That <code class="language-plaintext highlighter-rouge">obt test</code> runs Sass, JavaScript, and limited accessibility tests.</li>
  <li>That <code class="language-plaintext highlighter-rouge">obt verify</code> analyses our component for potential errors.</li>
  <li>How to write Sass tests for the <code class="language-plaintext highlighter-rouge">obt test</code> command.</li>
  <li>How to write and run JavaScript tests for the <code class="language-plaintext highlighter-rouge">obt test</code> command.</li>
  <li>How to highlight visual differences a change has introduced with <a href="https://percy.io/">percy.io</a>.</li>
</ul>

<p>So far we have missed a crucial part of creating a component: documentation. Without documentation our component will be difficult for users to include in projects and future development may be hindered. In part seven we’ll document our component in a way that is familiar to users and maintainers of other Origami components. <a href="/documentation/tutorials/create-a-new-component-part-7">Continue to part seven</a>.</p>
