import {Canvas, Meta, Story} from '@storybook/addon-docs';
import {withDesign} from 'storybook-addon-designs';
import withHtml from 'origami-storybook-addon-html';
import {Table} from '../src/tsx/table';
import {baseTableContents} from "./baseTableContents.js";
import {SelectFilter} from "../src/tsx/components";

<Meta
	title="components/o-table"
	component={Table}
	decorators={[withDesign, withHtml]}
	parameters={{design: {}, guidelines: {}, html: {}}}
/>

# Table With Filter

A table with a field which filters table rows based on the value in a given column.
<Canvas>
	<Story name="Table with filter">
		<Table>
			<SelectFilter></SelectFilter>
			{baseTableContents}
		</Table>
	</Story>
</Canvas>

All `o-table` instances support filtering on a single column. Filters may be applied declaratively in HTML or by calling the `o-table` JavaScript method `filter`.

The style of form elements used to filter a table are not determined by `o-table`. However we recommend using [o-forms](https://registry.origami.ft.com/components/o-forms) to style form elements used to filter an `o-table`, such as `input` or `select` elements. See the [o-table filter demos](https://registry.origami.ft.com/components/o-table#demo-filter) in the component registry for a demo using `o-forms` styles.

## Filter (declarative)

Declarative filters are case insensitive and perform partial matches, e.g. a filter of "Kingdom" would reveal "United Kingdom".

To enable declarative table filtering add the `data-o-table-filter-id` and `data-o-table-filter-column` to a form input. Where `data-o-table-filter-id` matches the `id` of the table to filter and `data-o-table-filter-column` is the numerical index of the column to filter (starting at 0).

For example, to filter a table based on a users selected option:
```html
	<label>Filter the table by country:</label>
	<!-- the filter input specifies the table id in "data-o-table-filter-id" -->
	<select data-o-table-filter-id="example-table" data-o-table-filter-column="0">
		<option value="" selected>All</option>
		<option value="​Austria">​Austria</option>
		<option value="​Belgium">​Belgium</option>
		<!-- more options  -->
	</select>

	<!-- the table markup, this may be a responsive table -->
	<div class="o-table-container">
		<!-- the table element with an id -->
		<table id="example-table">
			<!-- ... -->
		</table>
	</div>
```

Or to filter a table based on a users selected option:
```html
	<label>Filter the table by country:</label>
	<!-- the filter input specifies the table id in "data-o-table-filter-id" -->
	<input type="text" data-o-table-filter-id="example-table" data-o-table-filter-column="0"/>

	<!-- the table markup, this may be a responsive table -->
	<div class="o-table-container">
		<!-- the table element with an id -->
		<table id="example-table">
			<!-- ... -->
		</table>
	</div>
```

#### Filter (imperative)

The table's `filter` method may also be used to filter the table. Call it with the column index to filter and the filter to apply. The filter may be a string, which acts like a declarative filter (i.e. is case insensitive and performs a partial match):

```js
	const table = new OTable(tableElement);
	table.filter(0, 'United Kingdom'); // Filter the first table column by "United Kingdom".
```

Alternatively a callback function may be given. The callback should accept a table cell element and return a boolean value:

```js
	const table = new OTable(tableElement);
	table.filter(0, (cell) => {
		return parseInt(cell.textContent, 10) > 3;
	}); // Filter the first table column. Keep rows with a value more than 3.
```
